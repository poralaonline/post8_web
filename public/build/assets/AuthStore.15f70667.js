import{bD as R,y as V,i as v}from"./app.d57d51e9.js";import{f as s}from"./index.esm.159b9749.js";import"./auth.esm.925cebae.js";import{P as p}from"./PsApiService.1464e9d5.js";import{A as d}from"./ApiStatus.5720ba0b.js";import{P as k}from"./PsObject.a17ef38f.js";import{U as h}from"./User.0c3ba1a8.js";class g extends k{constructor(){super(...arguments),this.status="",this.message={}}init(a,u){return this.status=a,this.message=u,this}getPrimaryKey(){return this.status}fromMap(a){return new g().init(a.status,a.message)}fromMapList(a){const u=[];for(const c in a)c!=null&&u.push(this.fromMap(c));return u}toMap(a){const u={};return u.status=a.status,u.message=a.message,u}toMapList(a){const u=[];for(let c=0;c<a.length;c++)a[c]!=null&&u.push(this.toMap(a[c]));return u}}const H=R("authStore",()=>{const l=V({value:!1}),a=v(""),u=v();async function c(e,t){try{return await s.auth().createUserWithEmailAndPassword(e,t),!0}catch(i){a.value=i;try{const n=await s.auth().fetchSignInMethodsForEmail(e);return!0}catch(n){return a.value=n,console.log(n),!1}}}async function w(e,t){try{return await s.auth().signInWithEmailAndPassword(e,e),!0}catch(i){console.log(i);try{return await c(e,e),!0}catch(n){return a.value=n,console.log(n),!1}}}function y(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function P(e){l.value=e}async function U(){var i;const e=new s.auth.GoogleAuthProvider;e.addScope("email");const t=await s.auth().signInWithPopup(e).catch(n=>{a.value=n.message,console.log(a.value)});if(t!=null&&t.credential!=null){const n=(i=t.credential)!=null?i:null;let r;try{r=await s.auth().signInWithCredential(n);const o=s.auth().currentUser}catch{a.value="Google login failed."}if(s.auth()!=null&&r!=null&&r.user!=null){const o=r.user;if(o!=null)return o;a.value="Google login failed."}}}async function M(){var i;const e=new s.auth.OAuthProvider("apple.com");e.addScope("email"),e.addScope("name");const t=await s.auth().signInWithPopup(e).catch(n=>{a.value=n.message});if(t!=null&&t.credential!=null){const n=(i=t.credential)!=null?i:null;let r;try{r=await s.auth().signInWithCredential(n)}catch{a.value="Apple login failed."}if(s.auth()!=null&&r!=null&&r.user!=null){const o=r.user;if(o!=null)return o;a.value="Apple login failed."}}}async function A(){var i;const e=new s.auth.FacebookAuthProvider;e.addScope("email");const t=await s.auth().signInWithPopup(e).catch(n=>{a.value=n.message});if(t!=null&&t.credential!=null){const n=(i=t.credential)!=null?i:null;let r;try{r=await s.auth().signInWithCredential(n)}catch{a.value="Facebook login failed."}if(s.auth()!=null&&r!=null&&r.user!=null){const o=r.user;if(o!=null)return o;a.value="Facebook login failed."}}}async function C(e){return l.value=!0,await p.getUserExist(new d,e.toMap())}async function I(e){return await p.postUserCreate(new g,e.toMap())}async function W(e){var i,n,r,o,m;l.value=!0;let t="";if(e!=null&&(t=(i=e.email)!=null?i:"",(t==null||t=="")&&e.providerData!=null&&e.providerData.length>0))for(let f=0;f<e.providerData.length;f++)((n=e.providerData[f])==null?void 0:n.email)!=null&&((r=e.providerData[f])==null?void 0:r.email)!=""&&(t=(m=(o=e.providerData[f])==null?void 0:o.email)!=null?m:"");return e}async function S(e){l.value=!0;const t=await p.postForgotPassword(new d,e.toMap());return l.value=!1,t}async function D(e){l.value=!0;const t=await p.postUserCodeVerify(new h,e.toMap());return l.value=!1,t}async function E(e){l.value=!0;const t=await p.postResetPassword(new d,e.toMap());return l.value=!1,t}async function b(e){this.loading.value=!0;const t=await p.postUserRegister(new h,e.toMap());return this.loading.value=!1,t}async function F(e){l.value=!0;const t=await p.postUserEmailVerify(new h,e.toMap());return l.value=!1,t}async function G(e){l.value=!0;const t=await p.postResendCode(new d,e);return l.value=!1,t}return{postResendCode:G,postUserEmailVerify:F,registerUser:b,postUserCodeVerify:D,postResetPassword:E,postForgotPassword:S,createUserWithEmailAndPassword:c,signInWithEmailAndPassword:w,errorMessage:a,loginWithGoogleId:U,loading:l,submitLoginWithGoogleId:W,googleUser:u,existUser:C,createUserwithUsername:I,setLoading:P,isEmpty:y,loginWithFacebookId:A,loginWithAppleSignIn:M}});export{H as u};
